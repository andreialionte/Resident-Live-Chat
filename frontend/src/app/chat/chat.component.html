<div class="min-h-screen bg-gray-50 p-4 flex flex-col">
  <header class="w-full text-center py-4">
    <h1 class="text-2xl font-semibold text-indigo-600">Resident Live Chat</h1>
  </header>

  <main class="mx-auto w-full max-w-3xl bg-white rounded-xl shadow-md flex flex-col h-[72vh] sm:h-[80vh] overflow-hidden">
    <div class="flex-1 p-4 overflow-auto space-y-3" role="log" aria-live="polite">
      <div *ngFor="let m of messages" class="flex" [ngClass]="isSystemMessage(m) ? 'justify-center' : (isOwn(m) ? 'justify-end' : 'justify-start')">
        <div *ngIf="isSystemMessage(m)" class="text-center text-sm text-gray-500 italic py-1">
          <span class="font-medium">{{ m.username }}</span> {{ m.message }}
        </div>
        
        <ng-container *ngIf="!isSystemMessage(m)">
        <div *ngIf="!isOwn(m)" class="mr-3 flex-shrink-0">
          <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center text-sm font-semibold">
            {{ getInitials(m.username) }}
          </div>
        </div>

        <div class="max-w-full sm:max-w-[85%]">
          <div [ngClass]="isOwn(m) ? 'bg-indigo-600 text-white' : 'bg-indigo-50 text-gray-900'" class="p-3 rounded-lg shadow-sm">
            <div class="flex items-center gap-2 text-sm" [ngClass]="isOwn(m) ? 'justify-end text-indigo-100' : 'text-gray-500'">
              <strong class="text-sm" [ngClass]="isOwn(m) ? 'text-white' : 'text-gray-800'">{{ m.username }}</strong>
              <span class="text-xs opacity-70">{{ m.timestamp | date:'shortTime' }}</span>
            </div>
            <div class="mt-1">{{ m.message }}</div>
          </div>
        </div>

        <div *ngIf="isOwn(m)" class="ml-3 shrink-0">
          <div class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center text-sm font-semibold">
            {{ getInitials(m.username) }}
          </div>
        </div>
        </ng-container>
      </div>

      <div *ngIf="messages.length === 0" class="text-center text-gray-400">No messages. Write first!</div>
    </div>

    <form class="p-3 border-t bg-gradient-to-b from-white to-gray-50 flex gap-2 items-center" (ngSubmit)="send()" autocomplete="off">
      <input
        class="w-36 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300"
        name="username"
        [(ngModel)]="username"
        placeholder="Username (ex: Andrei)"
        maxlength="20"
        [disabled]="connected"
      />

      <input
        class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300"
        name="message"
        [(ngModel)]="message"
        placeholder="Scrie un mesaj..."
        required
        (keydown.enter)="send()"
      />

      <button type="submit" [disabled]="!message.trim() || !username.trim()" class="px-4 py-2 rounded-lg font-semibold bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed">Trimite</button>
    </form>
  </main>
</div>
